.TH MAKE-DEBIRF "8" "March 2007" "make-debirf 0.1" "Administration Commands"
.SH NAME
make-debirf \- build an initrd to boot a full Debian system entirely from RAM
.SH SYNOPSIS
.B make-debirf [profile] linux-image-2.6.18-4-486+inittmpfs_2_i386.deb
.SH DESCRIPTION
.PP
\fBmake-debirf\fP is a utility to build a debirf system.  A debirf system is a
kernel and an initramfs that can be passed to a machine at boot time to load a
complete Debian system entirely into RAM.  \fBmake-debirf\fP takes as input the
path to a linux-image-*.deb containing a linux kernel and modules (see \fBKERNEL
REQUIREMENTS\fP), and possibly a debirf profile (see \fBPROFILES\fP).
Make-debirf then generates a debirf initramfs and a kernel image.  The lovely
pair can be put into the boot partition of your machine in case of emergency,
burnt onto an .iso, served over the net via PXE, etc.
.PP
The debirf system is outlined at:
.PP
   http://cmrg.fifthhorseman.net/wiki/debirf
.PP
Unfortunately, \fBmake-debirf\fP must be run as root, since root is necessary to
properly build the debirf root with debootstrap, as well as to mount the
debirf chroot /proc. 
.PD
.SH KERNEL REQUIREMENTS
.PP
At the moment, the kernel that is passed to \fBmake-debirf\fP must have been
built with the EARLYUSERSPACE_ON_TMPFS (inittmpfs) patch.  Use
\fBbuild-debirf-kernel\fP to generate such a kernel package if you do not have
one handy.
.PD
.SH PROFILES
.PP
A debirf profile is a directory in /etc/debirf or a full path to a directory
that possibly contains a debirf.conf and/or 'plugins' sub-directory.  If a
profile is not specified, the default profile ('/etc/debirf/default') is
assumed.  If that profile is not found, the default variables will be used (see
\fBENVIRONMENT\fP below).
.PD
.SH PLUGINS
.PP
\fBPlugins\fP are a way to extend the capabilities of debirf.  A plugin is a
bash shell script that will execute during a "plugin install" phase of the
debirf build, right after the debirf debootstrap is complete and /sys and /proc
have been mounted.  The shell scripts in the plugin directory
(\fB$DEBIRF_PLUGINS\fP) are executed in an alpha-numeric order by
\fBrun-parts\fP.
.PP
The plugins can be used to configure the system put into the debirf initramfs.
All of the shell variables defined in the \fIdebirf.conf\fP file are available
to the plugins.
.PP
\fBNOTE:\fP The ordering of plugins is important.  Some plugins may depend on
certain other plugins having already, or not yet, been run.  For instance, the
plugin that cleans the debirf apt cache should be run near the end. 
.PD
.SH FUNCTIONS
.PP
A set of pre-defined bash shell functions are available to the plugins to
fasciliate configuring the debirf system:
.PD 1
.TP
.B debirf_exec <command>
Execute <command> within debirf root (\fBDEBIRF_ROOT\fP) with chroot.
.TP
.B msg <message>
Output a message to standard out during the build process.
.TP
.B failure <message> <exit-code>
Cause make-debirf script to fail with <exit-code>, and <message> to stderr.
.TP
.B debirf_info_sh <message>
Write one line of sh code to the \fIdebirf.info\fP file on the debirf root.
.TP
.B debirf_info_comment <message>
Write one line of comment to the \fIdebirf.info\fP file on the debirf root.
.RE
.PD
.SH ENVIRONMENT
.PP
The following environment variables are used by make-debirf:
.PD 1
.TP
.B DEBIRF_CONF
location of configuration (default: /etc/debirf/debirf.conf)
.PP
.B DEBIRF_LABEL
debirf label (default: debirf)
.TP
.B DEBIRF_BUILDD
where to build the debirf (default: /var/lib/debirf)
.TP
.B DEBIRF_ROOT
the debirf root, used by plugins (default: $DEBIRF_BUILDD/root)
.TP
.B DEBIRF_PLUGINS
the plugins directory (default: /usr/share/debirf/plugins)
.TP
.B DEBIRF_MIRROR
Debian mirror (default: http://mirrors.kernel.org/debian)
.TP
.B DEBIRF_DISTRO
debirf build distribution (default: lenny)
.PD
.SH FILES
.PD 1
.TP
/etc/debirf/<profile>/debirf.conf
Default configuration file.
.TP
$DEBIRF_ROOT/etc/debirf/debirf.info
File that stores various information about the debirf build.  This is a
bash-sourceable file.
.PD
.SH AUTHOR
Written by Jameson Rollins and Daniel Kahn Gillmor.
.SH "REPORTING BUGS"
Report bugs to <debirf@fifthhorseman.net>.
.SH COPYRIGHT
Copyright \(co 2007 Jameson Rollins and Daniel Kahn Gillmor
.br
This is free software.  You may redistribute copies of it under the terms of
the GNU General Public License <http://www.gnu.org/licenses/gpl.html>.
There is NO WARRANTY, to the extent permitted by law.
.SH "SEE ALSO"
.BR build-debirf-kernel (1),
.BR debootstrap (8)
